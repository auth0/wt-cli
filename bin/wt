#!/usr/bin/env node

var Bluebird = require('bluebird');
var Boom = require('boom');
var Colors = require('colors');
var Jws = require('jws');
var Promptly = require('promptly');
var Webtask = require('../');
var Yargs = require('yargs');
var _ = require('lodash');

Bluebird.longStackTraces();
Bluebird.promisifyAll(Promptly);


var commands = {
    profile: {
        description: 'Manage webtask profiles',
        handler: require('./profile'),
    },
    token: {
        description: 'Manage webtask tokens',
        handler: require('./token'),
    },
    logs: {
        description: 'Streaming, real-time logs',
        handler: require('./logs'),
    },
};

var yargs = Yargs.usage('Usage: $0 <command>');

_.forEach(commands, function (commandDef, command) {
    yargs.command(command, commandDef.description, commandDef.handler);
});

var argv = yargs.usage('Usage: $0 <command> [options]')
    .option('profile', {
        alias: 'p',
        type: 'string',
    })
    .help('help')
    .version(require('../package.json').version)
    .check(function (argv) {
        var commandName = argv._[1];
        var command = commands[commandName];
        
        if (!commandName) throw new Error('Please enter a valid command.');
        if (!command) throw new Error('No such command `' + commandName + '`');
    })
    .argv;
